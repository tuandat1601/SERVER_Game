import{Y as D,k as l,v as x,b0 as ee,O as ae,N as te,m as re,e as d,h,aU as S,aQ as oe,ae as ne,at as v,aR as le}from"./index-bd88d923.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-d18cc1b3.js";import{a as ie,g as ue}from"./game-c13a10d3.js";import{g as ce,a as de,b as pe}from"./customerservice-4138c2d1.js";import{z as me}from"./index.esm-cdf23848.js";import{u as y,w as ge}from"./xlsx-f5126985.js";import"./index-8426971e.js";import"./hooks-7977e933.js";function Ne(f){const t=D({gameId:1,serverId:1,roles:"",delivered:"2",paid:"2",rangCount:"请选择排行数量"}),N=l(),s=l([]),C=l([]),R=l([]),Y=l([]),i=l(!0),b=l(0),u=D({total:0,pageSize:100,pageSizes:[100,1e3,1e4],currentPage:1,background:!0}),A=e=>{const{columns:a,data:r}=e,o=[];return a.forEach((p,n)=>{if(n===0){o[n]="Total Cost";return}const m=r.map(c=>Number(c[p.property]));m.every(c=>Number.isNaN(c))?o[n]="N/A":o[n]=`$ ${m.reduce((c,W)=>{const Z=Number(W);return Number.isNaN(Z)?c:c+W},0)}`}),o},M=D({newPwd:""}),_=(e,a)=>Number(a.paid)===Number(e),z=(e,a)=>Number(a.delivered)===Number(e),F=l();l([]);const I=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"序号",prop:"id",minWidth:130},{label:"服务器ID",prop:"serverId",minWidth:130},{label:"游戏ID",prop:"gameId",minWidth:130},{label:"后台角色ID",prop:"gameBackendUserId",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量"},{label:"玩家ID",prop:"gameUserId",minWidth:130},{label:"游戏角色",prop:"gameRoleId",minWidth:130},{label:"角色名",prop:"gameRoleName",minWidth:130},{label:"商品ID",prop:"shopId",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量"},{label:"价格",sortable:!0,prop:"paidAmount",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量"},{label:"累计充值",sortable:!0,prop:"all_num",minWidth:130,hide:()=>t.rangCount==="请选择排行数量"},{label:"付费",prop:"paid",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量",formatter:({paid:e})=>Number(e)===1?d("div",null,[d("span",{style:"color: green"},[h("已支付")])]):d("div",null,[d("span",{style:"color: red"},[h("未支付")])]),filters:[{text:"已支付",value:"1"},{text:"未支付",value:"0"}],filterMethod:_,filterPlacement:"bottom-end",slot:"tag"},{label:"付费时间",sortable:!0,columnKey:"paidTime",prop:"paidTime",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量",formatter:({paidTime:e,paid:a})=>e&&Number(a)===1?S(e).format("YYYY-MM-DD HH:mm:ss"):"无"},{label:"发货",prop:"delivered",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量",formatter:({delivered:e})=>Number(e)===1?d("div",null,[d("span",{style:"color: green"},[h("已发货")])]):d("div",null,[d("span",{style:"color: red"},[h("未发货")])]),filters:[{text:"已发货",value:"1"},{text:"未发货",value:"0"}],filterMethod:z,filterPlacement:"bottom-end",slot:"tag"},{label:"创建时间",sortable:!0,columnKey:"createdAt",prop:"createdAt",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量",formatter:({createdAt:e})=>e?S(e).format("YYYY-MM-DD HH:mm:ss"):"无"},{label:"更新时间",sortable:!0,columnKey:"updatedAt",prop:"updatedAt",minWidth:130,hide:()=>t.rangCount!=="请选择排行数量",formatter:({updatedAt:e})=>e?S(e).format("YYYY-MM-DD HH:mm:ss"):"无"}],U=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"序号",prop:"id"},{label:"服务器ID",prop:"serverId"},{label:"游戏ID",prop:"gameId"},{label:"后台角色ID",prop:"gameBackendUserId"},{label:"玩家ID",prop:"gameUserId"},{label:"游戏角色",prop:"gameRoleId"},{label:"角色名",prop:"gameRoleName"},{label:"商品ID",prop:"shopId"},{label:"价格",prop:"paidAmount"},{label:"付费",prop:"paid"},{label:"付费时间",prop:"paidTime"},{label:"发货",prop:"delivered"},{label:"创建时间",prop:"createdAt"},{label:"更新时间",prop:"updatedAt"}],H=x(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);x(()=>{var e;return(e=ee())==null?void 0:e.roles});function L(e){}function $(e="新增",a){oe({title:`${e}通告`,props:{formInline:{title:e,name:(a==null?void 0:a.name)??"",rank:(a==null?void 0:a.rank)??0,dec:(a==null?void 0:a.dec)??""}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>ne(se,{ref:N}),beforeSure:(r,{options:o})=>{const p=N.value.getRef(),n=o.props.formInline;function m(){v(`您${e}了渠道名为${n.name}的这条数据`,{type:"success"}),r(),g()}p.validate(c=>{c&&m()})}})}const E=()=>{const e=s.value.map(p=>{const n=[];return I.forEach(m=>{n.push(p[m.prop])}),n}),a=[];I.forEach(p=>{a.push(p.label)}),e.unshift(a);const r=y.aoa_to_sheet(e),o=y.book_new();y.book_append_sheet(o,r,"数据报表"),ge(o,"recharge-table.xlsx"),v("导出成功",{type:"success"})};function P(e=0){k(e)}function G(e){v(`您删除了渠道名为${e.name}的这条数据`,{type:"success"}),deleteChannel(e.id),T()}function B(e){g()}function K(e){g()}function w(e){b.value=e.length,f.value.setAdaptive()}function O(){b.value=0,f.value.getTableRef().clearSelection()}function V(){const e=f.value.getTableRef().getSelectionRows();v(`已删除服务器为 ${le(e,"id")} 的数据`,{type:"success"}),f.value.getTableRef().clearSelection()}async function g(){const e={gameid:t.gameId,serverid:t.serverId,roleId:t.roles,page:u.currentPage,pagesize:u.pageSize};s.value=[];const{data:a}=await ce(e);s.value=a.info,u.total=a.totalpages?a.totalpages:1,setTimeout(()=>{i.value=!1},500)}async function j(){const e={gameid:t.gameId,serverid:t.serverId,roleId:t.roles,page:u.currentPage,pagesize:u.pageSize,paid:t.paid,delivered:t.delivered};s.value=[];const{data:a}=await de(e);s.value=a.info,u.total=a.totalpages?a.totalpages:1,setTimeout(()=>{i.value=!1},500)}async function J(e=10){const a={gameid:t.gameId,serverid:t.serverId,count:e};s.value=[];const{data:r}=await pe(a);s.value=r.info,u.total=r.totalpages?r.totalpages:1,setTimeout(()=>{i.value=!1},500)}async function Q(){i.value=!0;const{data:e}=await ie();C.value=e,setTimeout(()=>{i.value=!1,k(t.gameId)},300)}async function k(e){i.value=!0;const{data:a}=await ue(e);R.value=a,setTimeout(()=>{i.value=!1},500)}async function T(){}const q=e=>{e&&(t.rangCount="请选择排行数量",e.resetFields(),g())};ae(M,({newPwd:e})=>F.value=te(e)?-1:me(e).score);async function X(e){}return re(()=>{Q(),setTimeout(()=>{g()},1500)}),{form:t,columns1:U,loading:i,columns:I,dataList:s,gameDataList:C,sverDataList:R,channelDataList:Y,pagination:u,buttonClass:H,selectedNum:b,onSearch:T,onAddGame:$,exportExcel:E,onbatchDel:V,handleRole:X,resetForm:q,getSummaries:A,handleUpdate:L,handleDelete:G,onRechargeSearch:g,onSelectionGame:P,onRankingSearch:J,handleSizeChange:B,onSelectionCancel:O,onTJRechargeSearch:j,handleCurrentChange:K,handleSelectionChange:w}}export{Ne as useUser};
