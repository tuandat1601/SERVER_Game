import{Y as v,k as n,v as Z,O as w,N as ee,m as te,aS as I,e as l,r as b,aT as ae,aU as ne,as as le,at as o,aR as se,M as re,aQ as x,ae as ue,aV as ie,aW as oe,aX as ce,aY as de,F as pe}from"./index-bd88d923.js";import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-3f9c63b1.js";import{z as fe}from"./index.esm-cdf23848.js";import{u as ge}from"./hooks-142968e5.js";import{g as M,a as he,b as ve}from"./system-e8e4b1d8.js";import"./index-8426971e.js";function Ce(c,O){const d=v({deptId:"",username:"",phone:"",status:""}),y=n(),S=n(),k=n([]),f=n(!0);n();const u=n({}),{switchStyle:z}=ge(),R=n(),C=n([]),g=n(!0),h=n(0),p=v({total:0,pageSize:10,currentPage:1,background:!0}),P=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"用户编号",prop:"id",width:90},{label:"用户头像",prop:"avatar",cellRenderer:({row:e})=>l(b("el-image"),{fit:"cover","preview-teleported":!0,src:e.avatar,"preview-src-list":Array.of(e.avatar),class:"w-[24px] h-[24px] rounded-full align-middle"},null),width:90},{label:"用户名称",prop:"username",minWidth:130},{label:"用户昵称",prop:"nickname",minWidth:130},{label:"性别",prop:"sex",minWidth:90,cellRenderer:({row:e,props:t})=>l(b("el-tag"),{size:t.size,type:e.sex===1?"danger":"",effect:"plain"},{default:()=>[e.sex===1?"女":"男"]})},{label:"部门",prop:"dept.name",minWidth:90},{label:"手机号码",prop:"phone",minWidth:90,formatter:({phone:e})=>ae(e,{start:3,end:6})},{label:"状态",prop:"status",minWidth:90,cellRenderer:e=>{var t;return l(b("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=u.value[e.index])==null?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:z.value,onChange:()=>U(e)},null)}},{label:"创建时间",minWidth:90,prop:"createTime",formatter:({createTime:e})=>ne(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],$=Z(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),i=v({newPwd:""}),B=[{color:"#e74242",text:"非常弱"},{color:"#EFBD47",text:"弱"},{color:"#ffa500",text:"一般"},{color:"#1bbf1b",text:"强"},{color:"#008000",text:"非常强"}],m=n(),F=n([]);function U({row:e,index:t}){le.confirm(`确认要<strong>${e.status===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.username}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{u.value[t]=Object.assign({},u.value[t],{loading:!0}),setTimeout(()=>{u.value[t]=Object.assign({},u.value[t],{loading:!1}),o("已成功修改用户状态",{type:"success"})},300)}).catch(()=>{e.status===0?e.status=1:e.status=0})}function W(e){}function V(e){o(`您删除了用户编号为${e.id}的这条数据`,{type:"success"}),s()}function Y(e){}function E(e){}function H(e){h.value=e.length,c.value.setAdaptive()}function j(){h.value=0,c.value.getTableRef().clearSelection()}function A(){const e=c.value.getTableRef().getSelectionRows();o(`已删除用户编号为 ${se(e,"id")} 的数据`,{type:"success"}),c.value.getTableRef().clearSelection()}async function s(){f.value=!0;const{data:e}=await M(re(d));k.value=e.list,p.total=e.total,p.pageSize=e.pageSize,p.currentPage=e.currentPage,setTimeout(()=>{f.value=!1},500)}const N=e=>{e&&(e.resetFields(),d.deptId="",O.value.onTreeReset(),s())};function _({id:e,selected:t}){d.deptId=t?e:"",s()}function D(e){if(!e||!e.length)return;const t=[];for(let a=0;a<e.length;a++)e[a].disabled=e[a].status===0,D(e[a].children),t.push(e[a]);return t}function L(e="新增",t){x({title:`${e}用户`,props:{formInline:{title:e,higherDeptOptions:D(R.value),parentId:(t==null?void 0:t.dept.id)??0,nickname:(t==null?void 0:t.nickname)??"",username:(t==null?void 0:t.username)??"",password:(t==null?void 0:t.password)??"",phone:(t==null?void 0:t.phone)??"",email:(t==null?void 0:t.email)??"",sex:(t==null?void 0:t.sex)??"",status:(t==null?void 0:t.status)??1,remark:(t==null?void 0:t.remark)??""}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>ue(me,{ref:y}),beforeSure:(a,{options:r})=>{const G=y.value.getRef(),J=r.props.formInline;function T(){o(`您${e}了用户名称为${J.username}的这条数据`,{type:"success"}),a(),s()}G.validate(K=>{K&&T()})}})}function q(e){}w(i,({newPwd:e})=>m.value=ee(e)?-1:fe(e).score);function Q(e){x({title:`重置 ${e.username} 用户的密码`,width:"30%",draggable:!0,closeOnClickModal:!1,contentRenderer:()=>l(pe,null,[l(ie,{ref:S,model:i},{default:()=>[l(oe,{prop:"newPwd",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]},{default:()=>[l(ce,{clearable:!0,"show-password":!0,type:"password",modelValue:i.newPwd,"onUpdate:modelValue":t=>i.newPwd=t,placeholder:"请输入新密码"},null)]})]}),l("div",{class:"mt-4 flex"},[B.map(({color:t,text:a},r)=>l("div",{class:"w-[19vw]",style:{marginLeft:r!==0?"4px":0}},[l(de,{striped:!0,"striped-flow":!0,duration:m.value===r?6:0,percentage:m.value>=r?100:0,color:t,"stroke-width":10,"show-text":!1},null),l("p",{class:"text-center",style:{color:m.value===r?t:""}},[a])]))])]),closeCallBack:()=>i.newPwd="",beforeSure:t=>{S.value.validate(a=>{a&&(o(`已成功重置 ${e.username} 用户的密码`,{type:"success"}),t(),s())})}})}async function X(e){const t=(await ve({userId:e.id})).data??[];x({title:`分配 ${e.username} 用户的角色`,props:{formInline:{username:(e==null?void 0:e.username)??"",nickname:(e==null?void 0:e.nickname)??"",roleOptions:F.value??[],ids:t}},width:"400px",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1})}return te(async()=>{g.value=!0,s();const{data:e}=await M();R.value=I(e),C.value=I(e),g.value=!1,F.value=(await he()).data}),{form:d,loading:f,columns:P,dataList:k,treeData:C,treeLoading:g,selectedNum:h,pagination:p,buttonClass:$,onSearch:s,resetForm:N,onbatchDel:A,openDialog:L,onTreeSelect:_,handleUpdate:W,handleDelete:V,handleUpload:q,handleReset:Q,handleRole:X,handleSizeChange:Y,onSelectionCancel:j,handleCurrentChange:E,handleSelectionChange:H}}export{Ce as useUser};
