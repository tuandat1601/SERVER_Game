import{ar as j,bc as ee,Y as I,k as s,v as te,O as ae,N as ne,m as oe,e as r,F as L,r as f,aU as re,aQ as D,ae as se,at as p,aR as ie,h as le}from"./index-bd88d923.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-67337453.js";import{u as x}from"./customerservice-4138c2d1.js";import{g as ue,a as de}from"./game-c13a10d3.js";import{z as me}from"./index.esm-cdf23848.js";import{u as C,w as fe}from"./xlsx-f5126985.js";import"./index-8426971e.js";import"./hooks-7977e933.js";import"./hooks-20c90638.js";const pe=n=>{const a={gameId:n&&n.gameId?n.gameId:0,serverid:n.serverid,chattype:n.chattype?Number(n.chattype):1};return j.request("post",ee("games-mgr/beGetChatLog"),{data:a})};function ke(n){const a=I({id:0,gameId:1,serverid:1,title:"",chattype:1,content:"",items:[],itemStr:""}),k=s(),g=s([]),h=s([]),F=s([]),i=s(!0),v=s(0),R=I({total:0,pageSize:10,currentPage:1,background:!0}),N=I({newPwd:""}),T=s();s([]);const b=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"发送方",prop:"sender",minWidth:130},{label:"发送者",prop:"info",minWidth:130,cellRenderer:({row:e})=>r(f("el-popover"),{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:()=>r("div",{class:"node-item dark:text-bg_color"},[r(L,null,[S(e.info)])]),reference:()=>r(f("el-tag"),null,{default:()=>[e.info.length>1?S(e.info)+" ...":S(e.info)]})})},{label:"聊天类型",prop:"type",minWidth:130,cellRenderer:({row:e})=>r(f("el-popover"),{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:()=>r("div",{class:"node-item dark:text-bg_color"},[r(L,null,[y(e.type)])]),reference:()=>r(f("el-tag"),null,{default:()=>[e.type.length>1?y(e.type)+" ...":y(e.type)]})})},{label:"消息",prop:"msg",minWidth:130},{label:"发送时间",prop:"createdAt",minWidth:130,formatter:({createdAt:e})=>re(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],A=te(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function y(e){const t="公会聊天";return e===1?"全服聊天":t}function S(e){return e&&e.n?e.n:""}function G(e){}function M(e){const t=[];for(const o in e){const l=e[o];t.push(l)}return t}function W(){D({title:"错误提示！",contentRenderer:()=>r("p",null,[le("未正确选择游戏和游戏区服！")])})}function Y(e){const t={gameid:a.gameId,serverid:a.serverid,roleId:e,status:1};x(t)}function $(e){const t={gameid:a.gameId,serverid:a.serverid,roleId:e,status:2};x(t)}function z(e){const t={gameid:a.gameId,serverid:a.serverid,roleId:e,status:0};x(t)}function P(e="新增",t){let o=!1;if(a.serverid?(a.serverid===0||a.serverid===void 0)&&(o=!0):o=!0,a.gameId?(a.gameId===0||a.gameId===void 0)&&(o=!0):o=!0,o){W();return}D({title:`${e}激活码邮件`,props:{formInline:{serverid:(a==null?void 0:a.serverid)??0,gameId:(a==null?void 0:a.gameId)??0,title:(t==null?void 0:t.title)??"",content:(t==null?void 0:t.content)??0,items:(t==null?void 0:t.items)??[]}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>se(ce,{ref:k}),beforeSure:(l,{options:u})=>{const m=k.value.getRef(),d=u.props.formInline;function E(){p(`您${e}了激活码id为${d.id}的这条数据`,{type:"success"}),l(),c()}m.validate(Z=>{Z&&(e==="新增"?(addCodeEmail(d),E()):(updateCode(d),E()))})}})}const U=()=>{const e=g.value.map(u=>{const m=[];return b.forEach(d=>{m.push(u[d.prop])}),m}),t=[];b.forEach(u=>{t.push(u.label)}),e.unshift(t);const o=C.aoa_to_sheet(e),l=C.book_new();C.book_append_sheet(l,o,"数据报表"),fe(l,"chat-table.xlsx"),p("导出成功",{type:"success"})};function B(e){p(`您删除了激活码id为${e.id}的这条数据`,{type:"success"}),delCodeEmail(e),c()}function H(e){}function O(e){}function V(e){v.value=e.length,n.value.setAdaptive()}function q(){v.value=0,n.value.getTableRef().clearSelection()}function Q(){const e=n.value.getTableRef().getSelectionRows();p(`已删除服务器为 ${ie(e,"codeName")} 的数据`,{type:"success"}),n.value.getTableRef().clearSelection()}function _(e=1){w(e)}async function w(e){i.value=!0;const{data:t}=await ue(e);F.value=t,setTimeout(()=>{i.value=!1,c()},500)}async function J(){i.value=!0;const{data:e}=await de();h.value=e,setTimeout(()=>{i.value=!1,_(h.value.gameid)},500)}async function c(){i.value=!0;const{data:e}=await pe(a);g.value=M(e),R.total=e.total?e.total:1,setTimeout(()=>{i.value=!1},500)}const K=e=>{e&&(e.resetFields(),c())};ae(N,({newPwd:e})=>T.value=ne(e)?-1:me(e).score);async function X(e){}return oe(()=>{J()}),{form:a,loading:i,columns:b,dataList:g,gameDataList:h,pagination:R,buttonClass:A,selectedNum:v,sverDataList:F,onSearch:c,onAddGame:P,onClosePlayer:Y,onProhibition:$,onNoProhibition:z,onbatchDel:Q,handleRole:X,resetForm:K,exportExcel:U,handleUpdate:G,handleDelete:B,onSelectionGame:_,handleSizeChange:H,onSelectionCancel:q,handleCurrentChange:O,handleSelectionChange:V}}export{ke as useUser};
