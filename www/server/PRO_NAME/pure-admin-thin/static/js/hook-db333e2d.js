import{Y as y,k as i,v as Y,O as q,N as H,m as J,aQ as K,ae as V,at as h,aR as X,aG as k}from"./index-bd88d923.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang-ad53ca99.js";import{c as w,j as ee}from"./operations-67cacc8a.js";import{a as te,g as ae}from"./game-c13a10d3.js";import{z as ne}from"./index.esm-cdf23848.js";import{u as b,w as le}from"./xlsx-f5126985.js";import"./index-8426971e.js";import"./hooks-f0d9bd8c.js";function de(p){const e=y({gameId:1,serverid:1,arpu:0,today_amount:0,today_user:0,total_amount:0,total_user:0,range:[{min:1,max:20},{min:21,max:60},{min:61,max:100},{min:101,max:200},{min:201,max:300},{min:301,max:500},{min:501,max:1e3},{min:1001,max:5e3}],type:"0",listCom:["1-20","21-60","61-100","101-200","201-300","301-500","501-1000","1001-5000"]}),x=i(),f=i([]),S=i([]),u=i(!0),_=i([]),v=i(0),W=y({total:0,pageSize:10,currentPage:1,background:!0}),N=y({newPwd:""}),D=i();i([]);const g=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"区服",prop:"serverid",minWidth:130},{label:"等级区间1",prop:"lv0",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间2",prop:"lv1",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间3",prop:"lv2",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间4",prop:"lv3",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间5",prop:"lv4",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间6",prop:"lv5",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间7",prop:"lv6",hide:()=>e.type!=="0",minWidth:130},{label:"等级区间8",prop:"lv7",hide:()=>e.type!=="0",minWidth:130},{label:"关卡区间1",prop:"lv0",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间2",prop:"lv1",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间3",prop:"lv2",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间4",prop:"lv3",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间5",prop:"lv4",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间6",prop:"lv5",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间7",prop:"lv6",hide:()=>e.type!=="1",minWidth:130},{label:"关卡区间8",prop:"lv7",hide:()=>e.type!=="1",minWidth:130}],I=Y(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function L(t){}function R(){let t="级";return Number(e.type)===1&&(t="关"),t}function T(t=0){C(t)}function F(t="新增",a){K({title:`${t}区间`,props:{formInline:{title:t,arpu:(a==null?void 0:a.arpu)??0,today_amount:(a==null?void 0:a.today_amount)??0,today_user:(a==null?void 0:a.today_user)??0,total_amount:(a==null?void 0:a.total_amount)??0,total_user:(a==null?void 0:a.total_user)??0,range:e.range,lv1:e.range[0].max,lv2:e.range[1].max,lv3:e.range[2].max,lv4:e.range[3].max,lv5:e.range[4].max,lv6:e.range[5].max,lv7:e.range[6].max,lv8:e.range[7].max}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>V(Z,{ref:x}),beforeSure:(r,{options:o})=>{const l=x.value.getRef(),n=o.props.formInline;function c(){h(`您${t}了激活码名为${n.codeName}的这条数据`,{type:"success"}),r(),m()}l.validate(P=>{if(P)if(t==="新增")c();else{const d=e.range;for(let s=0;s<d.length;s++){const Q=d[s];Q.max=Number(n["lv"+(s+1)]),d[s+1]&&(d[s+1].min=Number(n["lv"+(s+1)])+1)}for(let s=0;s<e.listCom.length;s++)e.listCom[s]=e.range[s].min+"-"+e.range[s].max;m(),c()}})}})}const G=()=>{const t=f.value.map(l=>{const n=[];return g.forEach(c=>{n.push(l[c.prop])}),n}),a=[];g.forEach(l=>{a.push(l.label)}),t.unshift(a);const r=b.aoa_to_sheet(t),o=b.book_new();b.book_append_sheet(o,r,"数据报表"),le(o,"realtime-table.xlsx"),h("导出成功",{type:"success"})};function $(t){h(`您删除了arpu为${t.arpu}的这条数据`,{type:"success"}),w(t),m()}function z(t){}function M(t){}function j(t){v.value=t.length,p.value.setAdaptive()}function A(){v.value=0,p.value.getTableRef().clearSelection()}function E(){const t=p.value.getTableRef().getSelectionRows();h(`已删除服务器为 ${X(t,"codeName")} 的数据`,{type:"success"}),p.value.getTableRef().clearSelection()}async function O(){u.value=!0;const{data:t}=await te();S.value=t,setTimeout(()=>{u.value=!1,C(e.gameId)},500)}async function C(t){u.value=!0;const{data:a}=await ae(t),r=a,o=[];if(r.length>1){const l=k(r[0]);l.serverId=0,l.label="全服",o.push(l)}for(let l=0;l<r.length;l++){const n=r[l];n.label=n.serverId+"服",o.push(n)}_.value=o,setTimeout(()=>{u.value=!1},500)}async function m(){u.value=!0;const{data:t}=await ee(e),a=[t][0],r={};r.serverid=Number(e.serverid)===0?"全服":e.serverid;for(let n=0;n<a.length;n++){const c=a[n];r["lv"+n]=c}const o=[];o.push(k(r));const l=o[0];for(let n=0;n<8;n++)l["lv"+n]=e.listCom[n]+R();o.push(r),f.value=o,W.total=t.total?t.total:1,setTimeout(()=>{u.value=!1},500)}const U=t=>{t&&(t.resetFields(),m())};q(N,({newPwd:t})=>D.value=H(t)?-1:ne(t).score);async function B(t){}return J(()=>{O(),m()}),{form:e,loading:u,columns:g,dataList:f,gameDataList:S,sverDataList:_,pagination:W,buttonClass:I,selectedNum:v,onSearch:m,onAddGame:F,onbatchDel:E,handleRole:B,resetForm:U,exportExcel:G,handleUpdate:L,handleDelete:$,onSelectionGame:T,handleSizeChange:z,onSelectionCancel:A,handleCurrentChange:M,handleSelectionChange:j}}export{de as useUser};
