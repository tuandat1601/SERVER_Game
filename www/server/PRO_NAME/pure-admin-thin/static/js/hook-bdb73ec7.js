import{Y as k,k as i,v as H,O as J,N as K,m as V,aQ as X,ae as Z,G as u,at as S,aR as w}from"./index-bd88d923.js";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-7eec6b2c.js";import{C as T,D as ne,a as te,E as ae}from"./game-c13a10d3.js";import{z as ce}from"./index.esm-cdf23848.js";import"./index-8426971e.js";import"./hooks-142968e5.js";let p;function de(m){const c=k({channelAppId:0,gameId:0,sku:""}),b=i(),N=i([]),r=i([]),y=i([]),l=i(!0),g=i(0),A=k({total:0,pageSize:10,currentPage:1,background:!0}),$=k({newPwd:""}),z=i();i([]);const D=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"通知序号",prop:"rank",minWidth:130},{label:"通知名称",prop:"name",minWidth:130},{label:"通知备注",prop:"dec",minWidth:130},{label:"操作",fixed:"right",width:180,slot:"operation"}],F=H(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function L(e){}function M(e="新增",t){X({title:`${e}通告`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??"",rank:(t==null?void 0:t.rank)??0,dec:(t==null?void 0:t.dec)??""}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>Z(ee,{ref:b}),beforeSure:(n,{options:a})=>{const o=b.value.getRef(),s=a.props.formInline;function h(){S(`您${e}了渠道名为${s.name}的这条数据`,{type:"success"}),n(),d()}o.validate(x=>{x&&(e==="新增"?(O(s),h()):(W(s,t.rank),h()))})}})}function f(e,t){for(let n=0;n<t.length;n++){const a=t[n];if(e===a.id)return n}return 0}function C(e,t){for(let n=0;n<t.length;n++){const a=t[n];if(e===a.rank)return n}return 0}function v(e,t){for(let n=0;n<t.length;n++){const a=t[n];if(e===a.channelAppId)return n}return 0}function O(e){const t=u(p),n={dec:e.dec,name:e.name,rank:e.rank},a=f(c.gameId,t),o=v(c.channelAppId,t[a].channels);t[a].channels[o].notice.push(n),T(t[a]),I()}function W(e,t){const n=u(p),a={dec:e.dec,name:e.name,rank:Number(e.rank)},o=f(c.gameId,n),s=v(c.channelAppId,n[o].channels),h=u(n[o].channels[s].notice),x=C(a.rank,h);n[o].channels[s].notice[x]=a;const R=n[o].channels[s];R.gameId=n[o].id,ne(R),setTimeout(()=>{l.value=!1,d()},500)}function _(e){const t=u(p),n=f(c.gameId,t),a=v(c.channelAppId,t[n].channels),o=u(t[n].channels[a].notice),s=C(e,o);t[n].channels[a].notice.splice(s,1),T(t[n]),I()}function U(e){S(`您删除了渠道名为${e.name}的这条数据`,{type:"success"}),_(e.rank),d()}function j(e){}function P(e){}function Q(e){g.value=e.length,m.value.setAdaptive()}function Y(){g.value=0,m.value.getTableRef().clearSelection()}function q(){const e=m.value.getTableRef().getSelectionRows();S(`已删除服务器为 ${w(e,"id")} 的数据`,{type:"success"}),m.value.getTableRef().clearSelection()}async function G(){l.value=!0;const e=r.value;for(let n=0;n<e.length;n++){const a=e[n];c.sku===a.sku&&(c.gameId=a.id)}const t=f(c.gameId,r.value);y.value=r.value[t].channels,setTimeout(()=>{l.value=!1},500)}async function I(){l.value=!0;const{data:e}=await te();p=u(e),r.value=e,c.sku=r.value[0].sku,setTimeout(()=>{l.value=!1,c.sku&&G()},500)}async function d(){l.value=!0;const{data:e}=await ae(c);N.value=e,A.total=e.total?e.total:1,setTimeout(()=>{l.value=!1},500)}const B=e=>{e&&(e.resetFields(),d())};J($,({newPwd:e})=>z.value=K(e)?-1:ce(e).score);async function E(e){}return V(()=>{I()}),{form:c,loading:l,columns:D,dataList:N,gameDataList:r,channelDataList:y,pagination:A,buttonClass:F,selectedNum:g,onSearch:d,onAddGame:M,onbatchDel:q,handleRole:E,resetForm:B,onChannelSearch:G,handleUpdate:L,handleDelete:U,handleSizeChange:j,onSelectionCancel:Y,handleCurrentChange:P,handleSelectionChange:Q}}export{de as useUser};
