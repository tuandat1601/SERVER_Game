import{Y as b,k as s,v as j,O as q,N as H,m as J,e as u,F as K,r as D,aQ as E,ae as X,at as f,aR as Z,h as ee}from"./index-bd88d923.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_lang-c99aaf27.js";import{a as ae,u as ne,d as oe,g as se}from"./operations-67cacc8a.js";import{g as ie,a as re}from"./game-c13a10d3.js";import{z as le}from"./index.esm-cdf23848.js";import{u as x,w as ce}from"./xlsx-f5126985.js";import"./index-8426971e.js";import"./hooks-6a2b754a.js";import"./hooks-20c90638.js";function be(d){const a=b({id:0,gameId:1,serverid:1,title:"",content:"",items:[],itemStr:""}),C=s(),p=s([]),g=s([]),I=s([]),i=s(!0),h=s(0),y=b({total:0,pageSize:10,currentPage:1,background:!0}),R=b({newPwd:""}),_=s();s([]);const v=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"邮件ID",prop:"id",minWidth:130},{label:"游戏ID",prop:"gameId",minWidth:130},{label:"激活码奖励",prop:"title",minWidth:130},{label:"奖励道具",prop:"content",minWidth:130},{label:"附件",prop:"items",minWidth:130,cellRenderer:({row:e})=>u(D("el-popover"),{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:()=>u("div",{class:"node-item dark:text-bg_color"},[u(K,null,[S(e.items)])]),reference:()=>u(D("el-tag"),null,{default:()=>[e.items.length>1?S(e.items)+" ...":S(e.items)]})})},{label:"操作",fixed:"right",width:180,slot:"operation"}],L=j(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function S(e){let t="";for(let n=0;n<e.length;n++){const o=e[n];t=t+String(o.i)+","+String(o.n)+";"}return t}function T(e){}function N(e){const t=[];for(const n in e){const o=e[n];t.push(o)}return t}function W(){E({title:"错误提示！",contentRenderer:()=>u("p",null,[ee("未正确选择游戏和游戏区服！")])})}function $(e="新增",t){let n=!1;if(a.serverid?(a.serverid===0||a.serverid===void 0)&&(n=!0):n=!0,a.gameId?(a.gameId===0||a.gameId===void 0)&&(n=!0):n=!0,n){W();return}E({title:`${e}激活码邮件`,props:{formInline:{serverid:(a==null?void 0:a.serverid)??0,gameId:(a==null?void 0:a.gameId)??0,title:(t==null?void 0:t.title)??"",content:(t==null?void 0:t.content)??0,items:(t==null?void 0:t.items)??[]}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>X(te,{ref:C}),beforeSure:(o,{options:l})=>{const m=C.value.getRef(),c=l.props.formInline;function k(){f(`您${e}了激活码id为${c.id}的这条数据`,{type:"success"}),o(),r()}m.validate(Y=>{Y&&(e==="新增"?(ae(c),k()):(ne(c),k()))})}})}const z=()=>{const e=p.value.map(l=>{const m=[];return v.forEach(c=>{m.push(l[c.prop])}),m}),t=[];v.forEach(l=>{t.push(l.label)}),e.unshift(t);const n=x.aoa_to_sheet(e),o=x.book_new();x.book_append_sheet(o,n,"数据报表"),ce(o,"activateCode-table.xlsx"),f("导出成功",{type:"success"})};function A(e){f(`您删除了激活码id为${e.id}的这条数据`,{type:"success"}),oe(e),r()}function G(e){}function M(e){}function B(e){h.value=e.length,d.value.setAdaptive()}function O(){h.value=0,d.value.getTableRef().clearSelection()}function U(){const e=d.value.getTableRef().getSelectionRows();f(`已删除服务器为 ${Z(e,"codeName")} 的数据`,{type:"success"}),d.value.getTableRef().clearSelection()}function F(e=0){V(e)}async function V(e){i.value=!0;const{data:t}=await ie(e);I.value=t,setTimeout(()=>{i.value=!1,r()},500)}async function w(){i.value=!0;const{data:e}=await re();g.value=e,setTimeout(()=>{i.value=!1,F(g.value.gameid)},500)}async function r(){i.value=!0;const{data:e}=await se();p.value=N(e),y.total=e.total?e.total:1,setTimeout(()=>{i.value=!1},500)}const P=e=>{e&&(e.resetFields(),r())};q(R,({newPwd:e})=>_.value=H(e)?-1:le(e).score);async function Q(e){}return J(()=>{w()}),{form:a,loading:i,columns:v,dataList:p,gameDataList:g,pagination:y,buttonClass:L,selectedNum:h,sverDataList:I,onSearch:r,onAddGame:$,onbatchDel:U,handleRole:Q,resetForm:P,exportExcel:z,handleUpdate:T,handleDelete:A,onSelectionGame:F,handleSizeChange:G,onSelectionCancel:O,handleCurrentChange:M,handleSelectionChange:B}}export{be as useUser};
