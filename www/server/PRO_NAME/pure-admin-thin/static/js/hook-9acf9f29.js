import{Y as h,k as o,v as b,b0 as J,O as X,N as Z,m as D,aQ as k,ae as ee,at as d,aR as te,aG as ne,e as re,h as oe}from"./index-bd88d923.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-7d410fbe.js";import{a as ae,s as E,g as ie}from"./game-c13a10d3.js";import{z as le}from"./index.esm-cdf23848.js";import{u as g,w as ce}from"./xlsx-f5126985.js";import"./index-8426971e.js";import"./hooks-7977e933.js";import"./hooks-20c90638.js";import"./add-circle-line-a03ff6bd.js";function Se(u){const t=h({key:"",serverId:1,title:"",content:"",items:[],sender:"",owner:"",gameId:1,isAll:0,isTotal:0}),I=o(),S=o([]),f=o([]),m=o([]),T=o([]),s=o(!0),p=o(0),x=h({total:0,pageSize:10,currentPage:1,background:!0}),A=h({newPwd:""}),F=o();o([]);const v=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"验证KEY",prop:"key",minWidth:130},{label:"服务器ID",prop:"serverId",minWidth:130},{label:"标题",prop:"title",minWidth:130},{label:"内容",prop:"content",minWidth:130},{label:"附件",prop:"items",minWidth:130},{label:"发件人",prop:"sender",minWidth:130},{label:"收件人",prop:"owner",minWidth:130},{label:"游戏ID",prop:"gameId",minWidth:130}],C=b(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);b(()=>{var e;return(e=J())==null?void 0:e.roles});function R(e){}function W(){k({title:"错误提示！",contentRenderer:()=>re("p",null,[oe("未正确选择游戏和游戏区服！")])})}function _(e="发送",a){let n=!1;if(t.serverId?(t.serverId===0||t.serverId===void 0)&&(n=!0):n=!0,t.gameId?(t.gameId===0||t.gameId===void 0)&&(n=!0):n=!0,n){W();return}k({title:`${e}邮件`,props:{formInline:{key:t.key?t.key:"",serverId:t.serverId?t.serverId:0,title:t.title?t.title:"",content:t.content?t.content:"",items:t.items?t.items:[],sender:t.sender?t.sender:"",owner:t.owner?t.owner:"",gameId:t.gameId?t.gameId:0,isAll:t.isAll?t.isAll:0,isTotal:t.isTotal?t.isTotal:0}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>ee(se,{ref:I}),beforeSure:(i,{options:r})=>{const l=I.value.getRef(),c=r.props.formInline;function Q(){d(`您${e}了邮件为${c.name}的这条数据`,{type:"success"}),i()}l.validate(j=>{j&&(q(c),Q())})}})}const L=()=>{const e=S.value.map(r=>{const l=[];return v.forEach(c=>{l.push(r[c.prop])}),l}),a=[];v.forEach(r=>{a.push(r.label)}),e.unshift(a);const n=g.aoa_to_sheet(e),i=g.book_new();g.book_append_sheet(i,n,"数据报表"),ce(i,"recharge-table.xlsx"),d("导出成功",{type:"success"})};function N(e=0){y(e)}function $(e){d(`您删除了渠道名为${e.name}的这条数据`,{type:"success"}),deleteChannel(e.id),w()}function z(e){}function G(e){}function U(e){p.value=e.length,u.value.setAdaptive()}function M(e){return!(e&&e.info&&e.info.mainsId)}function B(){p.value=0,u.value.getTableRef().clearSelection()}function O(){const e=u.value.getTableRef().getSelectionRows();d(`已删除服务器为 ${te(e,"id")} 的数据`,{type:"success"}),u.value.getTableRef().clearSelection()}async function V(e){await E(e)}async function Y(){s.value=!0;const{data:e}=await ae();f.value=e,setTimeout(()=>{s.value=!1,y(t.gameId)},300)}async function q(e){s.value=!0,e.isAll===1&&(e.owner="all"),e.isAll;const a={key:e.key?e.key:"123",serverid:e.serverId,title:e.title?e.title:"测试邮件",content:e.content?e.content:"一件测试邮件",items:e.items?e.items:[],sender:e.sender?e.sender:"123",owner:Number(e.isAll)===1?"all":e.owner,gameId:e.gameId};if(e.isTotal===1){let i=0;for(let r=0;r<m.value.length;r++){const l=m.value[r],c=ne(a);c.serverid=l.serverId,M(l)&&(i=i+1,setTimeout(()=>{V(c)},500*i))}setTimeout(()=>{s.value=!1},500);return}const{data:n}=await E(a);f.value=n,setTimeout(()=>{s.value=!1},500)}async function H(){}async function y(e){s.value=!0;const{data:a}=await ie(e);m.value=a,setTimeout(()=>{s.value=!1},500)}async function w(){}const K=e=>{e&&e.resetFields()};X(A,({newPwd:e})=>F.value=Z(e)?-1:le(e).score);async function P(e){}return D(()=>{Y()}),{form:t,loading:s,columns:v,dataList:S,gameDataList:f,sverDataList:m,channelDataList:T,pagination:x,buttonClass:C,selectedNum:p,onSearch:w,queryEmail:H,onSendEmail:_,exportExcel:L,onbatchDel:O,handleRole:P,resetForm:K,handleUpdate:R,handleDelete:$,onSelectionGame:N,handleSizeChange:z,onSelectionCancel:B,handleCurrentChange:G,handleSelectionChange:U}}export{Se as useUser};
