import{Y as O,k as i,v as $,O as Ne,N as Fe,m as Re,e as s,r as c,aU as $e,at as v,aG as P,bD as m,aQ as D,bo as U,h as J,ae as T,aR as Ue}from"./index-bd88d923.js";import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang-1dff0576.js";import{_ as We}from"./index_mrege.vue_vue_type_script_setup_true_lang-f730f533.js";import{_ as Me}from"./index_chat.vue_vue_type_script_setup_true_lang-cf1c7dfa.js";import{_ as ze}from"./index_cross.vue_vue_type_script_setup_true_lang-41c92d26.js";import{p as x,q as Oe,r as Pe,t as xe,v as Be,w as Ae,x as Ee,y as Ve,z as Ge,A as Ye,g as Ze,a as Je,B as je}from"./game-c13a10d3.js";import{z as He}from"./index.esm-cdf23848.js";import{E as B,a as A}from"./types-5c2081a1.js";import"./index-8426971e.js";import"./hooks-142968e5.js";function st(_){const d=O({gameId:1,zoneId:0,serverId:0,channels:0,gameUrl:"",name:"",status:B.WaitOpen,workload:A.Smooth,isNew:"0",chatIP:"",openTime:""}),p=i(),l=i([]),N=i([]),b=i([]),k=i([]),y=i([]),g=i([]),h=i([]),C=i(!0),W=i("nohide"),E=i({}),j=i({}),L=i(-1),M=i(0),V=O({total:0,pageSize:10,currentPage:1,background:!0});$(()=>t=>{var e;return(e=E.value[t])==null?void 0:e.value});const H=$(()=>t=>{var e;return(e=j.value[t])==null?void 0:e.editing});$(()=>(t,e=!1)=>["cursor-pointer","ml-2","transition","delay-100",e?["hover:scale-110","hover:text-red-500"]:H.value(t)&&["scale-150","text-red-500"]]);const q=O({newPwd:""}),Q=i();i([]);const K=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"服务器ID",prop:"serverId",minWidth:130},{label:"游戏序号",prop:"gameId",minWidth:130,hide:!0},{label:"战区ID",prop:"zoneId",minWidth:130},{label:"渠道",prop:"channels",minWidth:130},{label:"合服",prop:"infoStr",minWidth:60},{label:"跨服",prop:"crossServerId",minWidth:60},{label:"游戏URL",prop:"gameUrl",minWidth:130,hide:()=>W.value==="hideURL"},{label:"游戏冠名",prop:"name",minWidth:130,hide:()=>W.value==="hideName"},{label:"聊天节点IP",prop:"chatIP",minWidth:130},{label:"状态",prop:"status",width:210,minWidth:60,cellRenderer:({row:t,index:e})=>s("div",{class:"flex-bc w-full h-[32px]",onMouseenter:()=>L.value=e,onMouseleave:()=>w(e)},[s(c("Transition"),{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(c("el-select"),{modelValue:t.status,"onUpdate:modelValue":a=>t.status=a,placeholder:"请输入服务器状态",class:"w-1/2"},{default:()=>[s(c("el-option"),{label:"待开启",value:"WaitOpen",onClick:()=>F(e)},null),s(c("el-option"),{label:"开启",value:"Open",onClick:()=>F(e)},null),s(c("el-option"),{label:"维护",value:"Maintain",onClick:()=>F(e)},null),s(c("el-option"),{label:"关闭",value:"Close",onClick:()=>F(e)},null)]})]})])},{label:"服务器工作状态",prop:"workload",width:170,minWidth:60,cellRenderer:({row:t,index:e})=>s("div",{class:"flex-bc w-full h-[32px]",onMouseenter:()=>L.value=e},[s(c("Transition"),{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(c("el-select"),{modelValue:t.workload,"onUpdate:modelValue":a=>t.workload=a,placeholder:"请输入服务器状态",class:"w-1/2"},{default:()=>[s(c("el-option"),{label:"流畅",value:"Smooth",onClick:()=>z(e)},null),s(c("el-option"),{label:"繁忙",value:"Busy",onClick:()=>z(e)},null),s(c("el-option"),{label:"爆满",value:"Packed",onClick:()=>z(e)},null)]})]})])},{label:"isNew",prop:"isNew",width:140,minWidth:60,cellRenderer:({row:t,index:e})=>s("div",{class:"flex-bc w-full h-[32px]",onMouseenter:()=>L.value=e},[s(c("Transition"),{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(c("el-select"),{modelValue:t.isNew,"onUpdate:modelValue":a=>t.isNew=a,placeholder:"请输入服务器状态",class:"w-1/2"},{default:()=>[s(c("el-option"),{label:"是",value:"1",onClick:()=>G(e)},null),s(c("el-option"),{label:"否",value:"0",onClick:()=>G(e)},null)]})]})])},{label:"开服时间",prop:"openTime",minWidth:130,formatter:({openTime:t})=>$e(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],X=$(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function w(t){var e;(e=E.value[t])!=null&&e.value?L.value=t:L.value=-1}function ee(t){if(t&&t.info){if(t.info.mainsId)return"合服到("+String(t.info.mainsId)+")";if(t.info.mergeIds)return"主服"+t.serverId}return""}function te(t){return t&&t.info&&t.info.crossServerId?t.info.crossServerId:""}function F(t){v(`您编辑了第 ${t+1} 行，编辑后数据为：${JSON.stringify(l.value[t])}`,{type:"success"});const e=l.value[t],a=P(e);a.status="",x(e,a),m(()=>{r()},300)}function z(t){v(`您编辑了第 ${t+1} 行，编辑后数据为：${JSON.stringify(l.value[t])}`,{type:"success"});const e=l.value[t],a=P(e);a.workload="",x(e,a),m(()=>{r()},300)}function G(t){v(`您编辑了第 ${t+1} 行，编辑后数据为：${JSON.stringify(l.value[t])}`,{type:"success"});const e=l.value[t],a=P(e);a.isNew="2",x(e,a),m(()=>{r()},300)}function ae(t){}function ne(){D({title:"维护确认",footerButtons:[{label:"取消",type:"danger",btnClick:({dialog:{options:t,index:e},button:a})=>{U(t,e)}},{label:"确认",text:!0,type:"success",btnClick:({dialog:{options:t,index:e},button:a})=>{Oe(d),U(t,e),m(()=>{r()},300)}}],contentRenderer:()=>s("p",null,[J("是否确定要一健维护")])})}function le(){D({title:"开启确认",footerButtons:[{label:"取消",type:"danger",btnClick:({dialog:{options:t,index:e},button:a})=>{U(t,e)}},{label:"确认",text:!0,type:"success",btnClick:({dialog:{options:t,index:e},button:a})=>{Pe(d),U(t,e),m(()=>{r()},300)}}],contentRenderer:()=>s("p",null,[J("是否确定要一健开启")])})}function Y(t){const e=t.split(","),a=[];for(let n=0;n<e.length;n++){const o=e[n];a.push(Number(o))}return a}function se(t,e){for(let a=0;a<e.length;a++){const n=e[a];if(t&&t.serverId&&t.serverId===n.serverId)return a}return 0}function ue(t,e){return e[t]}function ie(){let t="";for(let e=0;e<l.value.length;e++){const a=l.value[e];t=t+String(a.serverId),e+1<l.value.length&&(t=t+",")}return t}function ce(){const t=[];let e=0;for(let a=0;a<l.value.length;a++){const n=l.value[a];n.info&&n.info.mainsId||(t[e]=n.serverId,e=e+1)}return t}function re(t){const e=[],a=t.split(",");for(let n=0;n<a.length;n++){const o=a[n];e[n]=Number(o)}return e}function oe(){return l.value.length>0?Number(l.value[l.value.length-1].serverId)+1:1}function de(t="新增",e){D({title:`${t}聊天节点IP`,props:{formInline:{title:t,gameId:(e==null?void 0:e.gameId)??d.gameId,zoneId:(e==null?void 0:e.zoneId)??1,serverId:(e==null?void 0:e.serverId)??0,chatIP:(e==null?void 0:e.chatIP)??"",gameChatList:g.value?g.value:[]}},width:"46%",openDelay:20,draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>T(Me,{ref:p}),beforeSure:(a,{options:n})=>{const o=p.value.getRef(),u=n.props.formInline;function f(){v(`您${t}了服务器序号为${u.gameId}的这条数据`,{type:"success"}),m(()=>{r()},300),a()}o.validate(I=>{I&&(t==="新增"||(xe(u),f()))})}})}function me(t="新增",e){D({title:`${t}跨服`,props:{formInline:{title:t,gameId:(e==null?void 0:e.gameId)??d.gameId,zoneId:(e==null?void 0:e.zoneId)??1,serverId:(e==null?void 0:e.serverId)??0,crossServerId:(e==null?void 0:e.crossServerId)??0,crossServerList:h.value?h.value:[]}},width:"46%",openDelay:20,draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>T(ze,{ref:p}),beforeSure:(a,{options:n})=>{const o=p.value.getRef(),u=n.props.formInline;function f(){v(`您${t}了服务器序号为${u.gameId}的这条数据`,{type:"success"}),m(()=>{r()},300),a()}o.validate(I=>{I&&(t==="新增"||(Be(u),f()))})}})}function fe(t="新增",e){D({title:`${t}服务器`,props:{formInline:{title:t,gameId:(e==null?void 0:e.gameId)??d.gameId,zoneId:(e==null?void 0:e.zoneId)??1,serverId:(e==null?void 0:e.serverId)??oe(),channels:(e==null?void 0:e.channels)??0,gameUrl:(e==null?void 0:e.gameUrl)??"",name:(e==null?void 0:e.name)??"",status:(e==null?void 0:e.status)??B.WaitOpen,workload:(e==null?void 0:e.workload)??A.Smooth,isNew:(e==null?void 0:e.isNew)??"1",chatIP:(e==null?void 0:e.chatIP)??"",openTime:(e==null?void 0:e.openTime)??"",channelsStr:(e==null?void 0:e.channels)??b.value.toString(),channelList:b.value?b.value:[],gameUrlList:y.value?y.value:[],gameChatList:g.value?g.value:[],gameZoneList:k.value?k.value:[],crossServerList:h.value?h.value:[]}},width:"46%",openDelay:20,draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>T(Te,{ref:p}),beforeSure:(a,{options:n})=>{const o=p.value.getRef(),u=n.props.formInline;function f(){v(`您${t}了服务器序号为${u.gameId}的这条数据`,{type:"success"}),m(()=>{r()},300),a()}o.validate(I=>{if(I)if(t==="新增")u.channels=Y(n.props.formInline.channelsStr),Ae(u),f();else{const S=ue(se(e,l.value),l.value);let R=n.props.formInline.channelsStr;typeof n.props.formInline.channelsStr!="string"&&(R=n.props.formInline.channelsStr.toString()),u.channels.toString()!==n.props.formInline.channelsStr&&(u.channels=Y(R)),e.openTime===u.openTime?Ee(u,S):Ve(u,S),f()}})}})}function ve(t="合并",e){D({title:`${t}服务器`,props:{formInline:{title:t,gameId:(e==null?void 0:e.gameId)??d.gameId,zoneId:(e==null?void 0:e.zoneId)??1,serverId:(e==null?void 0:e.serverId)??0,channels:(e==null?void 0:e.channels)??0,gameUrl:(e==null?void 0:e.gameUrl)??"",name:(e==null?void 0:e.name)??"",status:(e==null?void 0:e.status)??B.WaitOpen,workload:(e==null?void 0:e.workload)??A.Smooth,isNew:(e==null?void 0:e.isNew)??"1",chatIP:(e==null?void 0:e.chatIP)??"",openTime:(e==null?void 0:e.openTime)??"",channelsStr:(e==null?void 0:e.channels)??"",channelList:b.value?b.value:[],gameUrlList:y.value?y.value:[],gameChatList:g.value?g.value:[],gameZoneList:k.value?k.value:[],crossServerList:h.value?h.value:[],serverIdListStr:ie(),mregeSvrListStr:"",svrList:ce(),svrItem:"",selecSvrList:[]}},width:"46%",openDelay:20,draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>T(We,{ref:p}),beforeSure:(a,{options:n})=>{const o=p.value.getRef(),u=n.props.formInline;function f(){v(`您${t}了服务器序号为${u.gameId}的这条数据`,{type:"success"}),m(()=>{r()},100),a()}o.validate(I=>{if(I)if(t==="合并"){const S={},R=u.mregeSvrListStr,_e=re(R);S.gameId=u.gameId,S.targetId=Number(u.targeSvrStr),S.sourceId=_e,Ge(S),f()}else f()})}})}function pe(t){v(`您删除了服务器序号为${t.gameId}的这条数据`,{type:"success"}),Ye(t),m(()=>{r()},100)}function ge(t){}function he(t){}function Ie(t){M.value=t.length,_.value.setAdaptive()}function Se(){M.value=0,_.value.getTableRef().clearSelection()}function be(){const t=_.value.getTableRef().getSelectionRows();v(`已删除服务器为 ${Ue(t,"gameId")} 的数据`,{type:"success"}),_.value.getTableRef().clearSelection()}function Ce(t){const e=[];for(let a=0;a<t.length;a++){const n=t[a];e[a]=n.channelAppId}return e}async function De(){const{data:t}=await je(d);k.value=t,setTimeout(()=>{C.value=!1},500)}async function r(){C.value=!0;const{data:t}=await Ze(d.gameId);l.value=t;for(let e=0;e<l.value.length;e++){const a=l.value[e];a.isNew=String(a.isNew),a.infoStr=ee(a),a.crossServerId=te(a)}V.total=t.total?t.total:0,setTimeout(()=>{C.value=!1,De(),Z()},500)}async function ke(){}async function Z(){C.value=!0;const{data:t}=await Je();N.value=t;for(let e=0;e<N.value.length;e++){const a=N.value[e];a&&a.id===d.gameId&&(b.value=Ce(a.channels),y.value=a.gameUrl,a.info&&a.info.chatIPs?g.value=a.info.chatIPs:g.value=[],a.info&&a.info.crossServer?h.value=a.info.crossServer:h.value=[])}setTimeout(()=>{C.value=!1},500)}const ye=t=>{t&&(t.resetFields(),r())};Ne(q,({newPwd:t})=>Q.value=Fe(t)?-1:He(t).score);async function Le(t){}return Re(()=>{ke(),r()}),{form:d,hideVal:W,loading:C,columns:K,dataList:l,gameDataList:N,pagination:V,buttonClass:X,selectedNum:M,onSearch:r,onAddGame:fe,onMergeGame:ve,onChatGame:de,onbatchDel:be,handleRole:Le,resetForm:ye,handleUpdate:ae,handleDelete:pe,onGameSearch:Z,onCrossSvrGame:me,onShowPreseClick:ne,onShowOpenClick:le,handleSizeChange:ge,onSelectionCancel:Se,handleCurrentChange:he,handleSelectionChange:Ie}}export{st as useUser};
